{% extends 'wss/base.html' %}
{% load static %}
{% load legoo_tag %}
{% block title_block %}投保{% endblock %}

{% block container_block %}
<style>
.weui_uploader_input_wrp {
  float: left;
  position: relative;
  margin-right: 9px;
  margin-bottom: 9px;
  width: 98%;
  height: 120px;
  border: 1px solid #D9D9D9;
  margin:0 auto;
}
.weui_uploader_file {
  float: left;
  margin-right: 9px;
  margin-bottom: 9px;
  width: 98%;
  height: 120px;
  background: no-repeat center center;
  background-size: cover;
}
.weui_input {
  width: 100%;
  border:0px solid #C8C8CD;  
  border-radius: 3px !important;
  outline: 0;
  -webkit-appearance: none; 
  background-color: transparent;
  font-size: 14px;
  color: inherit;
  height: 2em;
  line-height: 2em;
}

#szx,#blx ,#sjx,#ckx,#hhx{
  width: 100%;
  border:0px solid #C8C8CD;  
  border-radius: 3px !important;
  outline: 0;
  -webkit-appearance: none; 
  background-color: #5172D5;
  font-size: 14px;
  color: #fff;
  height: 2em;
  line-height: 2em;
}
#item-ifo #ico {
width: 16px;
height: 16px;
position: absolute;
top: 22px;
left: 42px;
z-index: 3;
color:#fff;
} 
.weui_media_title_1{
font-size:14px;
text-align:left;
}
.weui_media_desc_1{
text-align:left;
}
</style>
<link href="{% static 'css/validate.css' %}" rel="stylesheet">
{% if message %}
    <div class="weui_dialog_alert">
        <div class="weui_mask"></div>
        <div class="weui_dialog">
            <div class="weui_dialog_hd"><strong class="weui_dialog_title">提示</strong></div>
            <div class="weui_dialog_bd">{{ message }}</div>
            <div class="weui_dialog_ft">
                <a onclick="close_dialog();" class="weui_btn_dialog primary">确定</a>
            </div>
        </div>
    </div>
{% endif %}
<link href="{% static 'css/zzsc.css' %}" rel="stylesheet">
<script type="text/javascript">
pushHistory(); 
window.addEventListener("popstate", function(e) { 
    //alert("我监听到了浏览器的返回按钮事件啦");//根据自己的需求实现自己的功能 
    close_window()
}, false); 

function pushHistory() { 
    var state = { 
        title: "title", 
        url: "#"
    }; 
    window.history.pushState(state, "title", "#"); 
}
</script>
<!--   测试关闭页面  -->
<script src="{% static 'js/ajax-wx.js' %}"></script>
    <div id="detail_model" class="row control-show"style=" z-index: 9999999;">
		<div class="weui_dialog_alert">
		        <div class="weui_mask"></div>
		        <div class="weui_dialog">
		            <div class="weui_dialog_hd"><strong class="weui_dialog_title">提示</strong></div>
		            <div class="weui_dialog_bd"><font id="id_message_id"></font></div>
		            <div class="weui_dialog_ft">
		            	<a href="javascript:;" class="weui_btn_dialog primary" onclick="$('#detail_model').addClass('control-show');">确定</a>
		            </div>
		        </div>
		    </div>
    </div>

<div class="top">
	<table class="tabel" border="0" cellspacing="0" cellpadding="0"   >
		<tbody>
			<tr>
					<td width="20%" valign="middle">
							<a class="btn1" onclick="history.go(-1)"><i class="fa fa-chevron-left"></i></a>
					</td>
					<td class="wz" width="60%" valign="middle" align="center">
							<span id="toptitle">
									<i class="fa   fa-file-text"></i>&nbsp;<strong>基本信息</strong>
							</span>
					</td>
					<td width="20%" valign="middle" align="right">
					<a id="aso" href="#"></a>
					</td>
			</tr>
		</tbody>
	</table>

</div>
 
<form id="msform" method="POST" enctype="multipart/form-data">  {% csrf_token %}
<input class="" type="hidden"  name="order_car_type" 
{% if order_car_type %}value="{{order_car_type}}"
{% elif posted_data.order_car_type %}value="{{posted_data.order_car_type}}"
{% else %}value=""{% endif %}/>
<input class="" type="hidden" name="plate_number" 
{% if plate_number %}value="{{plate_number}}"
{% elif posted_data.plate_number %}value="{{posted_data.plate_number}}"
{% else %}value=""{% endif %}/>
<input class="" type="hidden" name="city_code" 
{% if city_code %}value="{{city_code}}"
{% elif posted_data.city_code %}value="{{posted_data.city_code}}"
{% else %}value=""{% endif %}/>
<input  type="hidden" name="jdclbx_state" value='create'>
   <!-- progressbar -->
	<!-- 		<ul id="progressbar" style="width: 100%;margin: 10px auto;text-align: center;position: relative;"> -->
	<ul id="progressbar" style="width: 100%;"> 
				<li class="active">车辆信息</li>
				<li>投保人</li>
				<li>选择险种</li>
				<li>保险起期</li>
			</ul>
	<!-- fieldsets -->
	<fieldset>
	    <h2 class="fs-title"><a href="javascript:;" id="pb2"><i class="fa  fa-eye" style="  float: right;position: relative;background:#5172D5; color:#FFF; font-size:12px;width:80px;height:20px;line-height:20px;">查看示例</i></a></h2>
            <div class="weui_cells weui_cells_form"  style="text-align:center">         
                    <div class="weui_cell">
                        <div class="weui_cell_bd weui_cell_primary">
                            <div class="weui_uploader">
                                <div class="weui_uploader_bd">
                                    <ul class="weui_uploader_files ul_driving_license">
                                    </ul>
                                    <div class="weui_uploader_input_wrp" >
                                        <input class="weui_uploader_input  driving_license" name="driving_license" type="file" accept="image/jpg,image/jpeg,image/png,image/gif" data-required="true" data-descriptions="driving_license_up"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
            </div>
            <h3 class="fs-subtitle">上传行驶证正页</h3>
               <div class="weui_cells weui_cells_form" >
                   <div class="weui_cell" >
                        <div class="weui_cell_bd weui_cell_primary">
                            <div class="weui_uploader">
                                <div class="weui_uploader_bd">
                                    <ul class="weui_uploader_files ul_driving_license_down">
                                    </ul>
                                    <div class="weui_uploader_input_wrp">
                                        <input class="weui_uploader_input driving_license_down" name="driving_license_down" type="file" accept="image/jpg,image/jpeg,image/png,image/gif" data-required="true" data-descriptions="driving_license_down" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
          <h3 class="fs-subtitle">上传行驶证附页</h3>	
        <h3 class="fs-subtitle">注：以下信息仅用于投保，请放心提交!</h3>
		<input type="button" name="next" class="next action-button" value="下一步" />
	</fieldset>
	<fieldset style="font-size:14px;">
		  <div class="weui_cell weui_cell_switch wss_bg">
			        <div class="weui_cell_hd" >投保人是否与行驶证所有人相同</div>
			         <div class="weui_cell_bd weui_cell_primary " ></div>
			        <div class="weui_cell_ft">
			          <input class="weui_switch" type="checkbox"  
			          {% if posted_data.ismatchxsz == 'on' or not  posted_data %} checked {% endif %} id="ismatchxsz"  name="ismatchxsz">
			        </div>
			    </div>
		    	<div class="weui_cell wss_dashed_bottom"  style="padding:10px 2px;">
			            <div class="weui_cell_hd" style="width:40%;text-align: left;">【用户类型】</div>
			                <div class="weui_cell_bd weui_cell_primary " >
										<input class="weui_input" type="text" placeholder="请输入用户类型"  id="user_classify" name="user_classify"
										{% if posted_data.user_classify %}value="{{posted_data.user_classify}}"{% else%} value="个人"{% endif %}/>
			                </div>
			   		</div>
			    	{% if posted_data.ismatchxsz  != 'on'  and  posted_data.user_classify|toString == '单位'|toString %}
			     	<div style="display: block" id="company">
			     	{% else %}
			     	<div style="display: none" id="company">
			     	{% endif %}
			    	  <div class="weui_cell  wss_dashed_bottom"  style="padding:10px 2px;">
				            <div class="weui_cell_hd" style="width:40%;	text-align: left;">【单位名称】</div>
				                <div class="weui_cell_bd weui_cell_primary " >
											<input class="weui_input" type="text" placeholder="请输入单位名称"  id="applicant_company_name" name="applicant_company_name" 
											{% if posted_data.applicant_company_name %}value="{{posted_data.applicant_company_name}}"{% else%}value='' {% endif %}  data-required="true" data-descriptions="applicant_company_name"/>
				                </div>
				        </div>
				      </div>
				      {% if posted_data.ismatchxsz == ''  and  posted_data.user_classify|toString == '个人'|toString %}
				     	<div style="display: block" id="person">
				     	{% else %}
				     	<div style="display: none" id="person">
				     	{% endif %}
				             <div class="weui_cell  wss_dashed_bottom"  style="padding:10px 2px;">
				                 <div class="weui_cell_hd" style="width:40%;	text-align: left;"><label for="" class="weui_label">【投保人姓名】</label></div>
				                 <div class="weui_cell_bd weui_cell_primary " >
											<input class="weui_input" type="text" placeholder="请输入投保人姓名"  id="applicant_name" name="wx_applicant_name" 
											{% if posted_data.wx_applicant_name %}value="{{posted_data.wx_applicant_name}}"{% else%}value='' {% endif %}/>
				                 </div>
				             </div>
				        </div>
				       <div class="weui_cell wss_dashed_bottom"   style="padding:10px 2px;" >
			            <div class="weui_cell_hd" style="width:40%;text-align: left;">【手机号码】</div>
		                <div class="weui_cell_bd weui_cell_primary " >
									<input class="weui_input" type="text" data-pattern="^(13[0-9]|15[012356789]|17[3678]|18[0-9]|14[57])[0-9]{8}$" data-descriptions="telphone1" 
									 data-required="true"  placeholder="投保人手机号码"  id="applicant_phone" name="applicant_phone" 
									 {% if posted_data.applicant_phone %}value="{{posted_data.applicant_phone}}"{% else%}value='' {% endif %}/>
		                </div>
					   </div>

				   		{% if posted_data.user_classify|toString == '单位'|toString %}
				   		<div style="display: block" id="company1">
				   		{% else %}
				        <div style="display: none" id="company1">
				        {% endif %}
				                <div class="weui_cells weui_cells_form" >
						                   <div class="weui_cell">
						                        <div class="weui_cell_bd weui_cell_primary">
						                            <div class="weui_uploader">
						                                <div class="weui_uploader_bd">
						                                    <ul class="weui_uploader_files ul_national_image_yingye">
						                                    </ul>
						                                    <div class="weui_uploader_input_wrp">
						                                        <input class="weui_uploader_input national_image_yingye" name="national_image_yingye" type="file" accept="image/jpg,image/jpeg,image/png,image/gif"/>
						                                    </div>
						                                </div>
						                            </div>
						                        </div>
						                    </div>
						                </div>
						           <h3 class="fs-subtitle">组织机构代码证号/三证合一填写营业执照</h3>
				                </div>
				                
				   		{% if posted_data.user_classify|toString == '个人'|toString or not posted_data %}
				   		<div style="display: block" id="person1">
				   		{% else %}
				        <div style="display: none" id="person1">
				        {% endif %}
				                 <div class="weui_cells weui_cells_form">         
				                    <div class="weui_cell" >
				                        <div class="weui_cell_bd weui_cell_primary">
				                            <div class="weui_uploader">
				                                <div class="weui_uploader_bd">
				                                    <ul class="weui_uploader_files ul_national_image">
				                                    </ul>
				                                    <div class="weui_uploader_input_wrp" >
				                                        <input class="weui_uploader_input national_image" name="carded_image" type="file" accept="image/jpg,image/jpeg,image/png,image/gif"/>
				                                    </div>
				                                </div>
				                            </div>
				                        </div>
				                    </div>
				                </div>
                                <h3 class="fs-subtitle">上传投保人身份证正面照</h3>
                                <div class="weui_cells weui_cells_form" >         
				                   <div class="weui_cell" >
				                        <div class="weui_cell_bd weui_cell_primary">
				                            <div class="weui_uploader">
				                                <div class="weui_uploader_bd">
				                                    <ul class="weui_uploader_files ul_national_image_down">
				                                    </ul>
				                                    <div class="weui_uploader_input_wrp">
				                                        <input class="weui_uploader_input national_image_down" name="carded_image_down" type="file" accept="image/jpg,image/jpeg,image/png,image/gif"/>
				                                    </div>
				                                </div>
				                            </div>
				                        </div>
				                         </div>
				                    </div>
									<h3 class="fs-subtitle">上传投保人身份证反面照</h3>
				</div>
				<div class="weui_cell weui_cell_switch wss_bg">
			        <div class="weui_cell_hd ">被投保人是否与投保人相同</div>
			        <div class="weui_cell_bd weui_cell_primary " ></div>
			        <div class="weui_cell_ft">
			          <input class="weui_switch" type="checkbox"  
			          {% if posted_data.ismatchtbr == 'on' or not posted_data %}    checked  {% endif %}id="ismatchtbr" name="ismatchtbr">
			        </div>
			    </div>
			    {% if posted_data.ismatchtbr != 'on' and posted_data %}
			   <div style="display: block" id="notmatchtbr">
			   {% else %}
			   <div style="display: none" id="notmatchtbr">
			   {% endif %}
			   
			        <div class="weui_cell  wss_dashed_bottom" style="padding:10px 2px;" >
			            <div class="weui_cell_hd" style="width:40%;	text-align: left;">【被保人姓名】</div>
			                <div class="weui_cell_bd weui_cell_primary " >
										<input class="weui_input" type="text" placeholder="请输入被保险人姓名"  id="insured_name" name="insured_name"
										{% if posted_data.insured_name  %} value="{{posted_data.insured_name}}"{% else %}value=""{% endif %}/>
			                </div>
			        </div>
			       <div class="weui_cell  wss_dashed_bottom" style="padding:10px 2px;" >
			            <div class="weui_cell_hd" style="width:40%;	text-align: left;">【手机号码】</div>
			                <div class="weui_cell_bd weui_cell_primary " >
										<input class="weui_input" data-pattern="^(13[0-9]|15[012356789]|17[3678]|18[0-9]|14[57])[0-9]{8}$" data-descriptions="telphone2"  data-required="true"  type="number"
										 placeholder="请输入被保人手机号"  id="insured_phone" name="insured_phone" 
										 {% if posted_data.insured_phone  %} value="{{posted_data.insured_phone}}"{% else %}value=""{% endif %}/>
			                </div>
			        </div>
			        <div class="weui_cell wss_dashed_bottom"  style="padding:10px 2px;">
				            <div class="weui_cell_hd" style="width:40%;text-align: left;">【用户类型】</div>
				                <div class="weui_cell_bd weui_cell_primary " >
											<input class="weui_input" type="text" placeholder="请输入用户类型"  id="bbx_user_classify" name="bbx_user_classify" 
											{% if posted_data.bbx_user_classify  %} value="{{posted_data.bbx_user_classify}}"{% else %}value="个人"{% endif %}/>
				                </div>
				   </div>
				   {% if posted_data.bbx_user_classify|toString == '单位'|toString  %}
				   <div style="display: block" id="bbx_company" class="wss_dashed_bottom">
				   {% else %}
				   <div style="display: none" id="bbx_company" class="wss_dashed_bottom">
				   {% endif %}
				                <div class="weui_cells weui_cells_form" >
						                   <div class="weui_cell">
						                        <div class="weui_cell_bd weui_cell_primary">
						                            <div class="weui_uploader">
						                                <div class="weui_uploader_bd">
						                                    <ul class="weui_uploader_files ul_bbx_national_image_yingye">
						                                    </ul>
						                                    <div class="weui_uploader_input_wrp">
						                                        <input class="weui_uploader_input bbx_national_image_yingye" name="bbx_national_image_yingye" type="file" accept="image/jpg,image/jpeg,image/png,image/gif"/>
						                                    </div>
						                                </div>
						                            </div>
						                        </div>
						                    </div>
						                </div>
						           <h3 class="fs-subtitle">组织机构代码证号/三证合一填写营业执照</h3>
				                </div>
				  {% if posted_data.bbx_user_classify|toString == '个人'|toString or not posted_data%}           
		         <div style="display: block" id="bbx_person"  class="wss_dashed_bottom" >
		         {% else %}
		         <div style="display: none" id="bbx_person"  class="wss_dashed_bottom" >
		         {% endif %}
				                 <div class="weui_cells weui_cells_form">         
				                    <div class="weui_cell" >
				                        <div class="weui_cell_bd weui_cell_primary">
				                            <div class="weui_uploader">
				                                <div class="weui_uploader_bd">
				                                    <ul class="weui_uploader_files ul_bbx_carded_image">
				                                    </ul>
				                                    <div class="weui_uploader_input_wrp" >
				                                        <input class="weui_uploader_input bbx_carded_image" name="bbx_carded_image" type="file" accept="image/jpg,image/jpeg,image/png,image/gif"/>
				                                    </div>
				                                </div>
				                            </div>
				                        </div>
				                    </div>
				                </div>
                                <h3 class="fs-subtitle">上传被保人身份证正面照</h3>
                                <div class="weui_cells weui_cells_form" >         
				                   <div class="weui_cell" >
				                        <div class="weui_cell_bd weui_cell_primary">
				                            <div class="weui_uploader">
				                                <div class="weui_uploader_bd">
				                                    <ul class="weui_uploader_files ul_bbx_carded_image_down">
				                                    </ul>
				                                    <div class="weui_uploader_input_wrp">
				                                        <input class="weui_uploader_input bbx_carded_image_down" name="bbx_carded_image_down" type="file" accept="image/jpg,image/jpeg,image/png,image/gif"/>
				                                    </div>
				                                </div>
				                            </div>
				                        </div>
				                         </div>
				                    </div>
									<h3 class="fs-subtitle">上传被保人身份证反面照</h3>
					</div>
		        </div>
		       {% if city_code != '1101'%}          
		        <div class="weui_cell  wss_dashed_bottom" style="padding:10px 2px;">
		            <div class="weui_cell_hd" style="width:40%;	text-align: left;">【保单快递地址】</div>
		                <div class="weui_cell_bd weui_cell_primary " >
									<input class="weui_input" type="text" placeholder="请选择保单快递地址"  id="ssq" name="policy_address"
									{% if posted_data.policy_address %} value="{{posted_data.policy_address }}"{% else %}value="" {% endif %}/>
		                </div>
		        </div>
		        <div class="weui_cell  wss_dashed_bottom" style="padding:10px 2px;">
		            <div class="weui_cell_hd" style="width:40%;	text-align: left;">【详细地址】</div>
		                <div class="weui_cell_bd weui_cell_primary " >
									<input class="weui_input" type="text" placeholder="请输入详细地址"  id="detailed_address" name="detailed_address"
									 {% if posted_data.detailed_address %} value="{{posted_data.detailed_address }}"{% else %}value="" {% endif %}/>
		                </div>
		        </div>
		        {% endif %}
		<input type="button" name="previous" class="previous action-button" value="上一步" />
		<input type="button" name="next" class="next action-button" value="下一步" />
	</fieldset>
	<fieldset>
	<div class="weui_cells" style="height:100%;">
	<div class="weui_panel weui_panel_access">
		      <div class="weui_panel_hd"  style="background:#F3F3F3;text-align:left;">交强险和车船使用税</div>
		      <div class="weui_panel_bd">
		        <a href="javascript:void(0);" class="weui_media_box weui_media_appmsg" style ="padding:0px 15px;">
			          <div class="weui_media_bd">
			            <h4 class="weui_media_title_1 weui_media_title "  style="font-size:14px;">交强险</h4>
			            <p class="weui_media_desc weui_media_desc_1">国家规定的强制保险</p>
			          </div>
			          <div class="weui_media_hd" style="margin-right:.1em">
			                <input class="weui_switch" type="checkbox"  {% if posted_data.liability_state == 'on' or not posted_data %} checked  {% endif %}id="jqx" name= "liability_state">
			          </div>
		        </a>
		        <a href="javascript:void(0);" class="weui_media_box weui_media_appmsg" style ="padding:0px 15px;">
			          <div class="weui_media_bd">
			            <h4 class="weui_media_title weui_media_title_1"  style="font-size:14px;">车船使用税</h4>
			            <p class="weui_media_desc weui_media_desc_1">以排量为收取标准的国家税收</p>
			          </div>
			         <div class="weui_media_hd" style="margin-right:.1em">
			                 <input class="weui_switch" type="checkbox"  {% if posted_data.vehicle_vessel_tax_state == 'on' or not posted_data %} checked  {% endif %}  id="ccs" name="vehicle_vessel_tax_state">
			          </div>
		        </a>
		      </div>
		</div>
			<div class="weui_panel weui_panel_access"  style="margin-top: 0px;">
		      <div class="weui_panel_hd"  style="background:#F3F3F3;text-align:left;">商业险</div>
		      <div class="weui_panel_bd">
		        <a href="javascript:void(0);" class="weui_media_box weui_media_appmsg" style ="padding:0px 15px;">
			          <div class="weui_media_bd">
			            <h4 class="weui_media_title weui_media_title_1" style="font-size:14px;" >三者险</h4>
			            <p class="weui_media_desc weui_media_desc_1">用于赔付对他人造成的财产损失</p>
			          </div>
			          <div class="weui_media_hd" style="margin-right:.1em"  id="item-ifo">
			                <input class="weui_input" type="text"    id="szx" name="third_insurance" style="font-size:12px;padding-left:4px;"
			                {% if posted_data.third_insurance %}value="{{posted_data.third_insurance}}" {% else %}value="10万" {% endif %} >
			                <i class="fa fa-angle-down" id="ico" ></i>
			          </div>
		        </a>
		        <a href="javascript:void(0);" class="weui_media_box weui_media_appmsg" style ="padding:0px 15px;">
			          <div class="weui_media_bd">
			            <h4 class="weui_media_title weui_media_title_1"  style="font-size:14px;">车损险</h4>
			            <p class="weui_media_desc weui_media_desc_1" >用于赔付自己车辆损失</p>
			          </div>
			         <div class="weui_media_hd" style="margin-right:.1em">
			                 <input class="weui_switch" type="checkbox"    id="csx" name="damage_insurance" {% if posted_data.damage_insurance == 'on'  %} checked  {% endif %}>
			          </div>
		        </a>
		        <a href="javascript:void(0);" class="weui_media_box weui_media_appmsg" style ="padding:0px 15px;">
			          <div class="weui_media_bd">
			            <h4 class="weui_media_title weui_media_title_1"  style="font-size:14px;">玻璃险</h4>
			            <p class="weui_media_desc weui_media_desc_1">用于赔付非抗力对玻璃造成的损失</p>
			          </div>
			          <div class="weui_media_hd" style="margin-right:.1em"  id="item-ifo">
			                <input class="weui_input" type="text"    id="blx"  name="glass_insurance" style="font-size:12px;padding-left:4px;"
			                {% if posted_data.glass_insurance %}value="{{posted_data.glass_insurance}}" {% else %}value="不投保" {% endif %} >
			                <i class="fa fa-angle-down" id="ico" ></i>
			          </div>
		        </a>
		        <a href="javascript:void(0);" class="weui_media_box weui_media_appmsg" style ="padding:0px 15px;">
			          <div class="weui_media_bd">
			            <h4 class="weui_media_title weui_media_title_1"  style="font-size:14px;">司机险</h4>
			            <p class="weui_media_desc weui_media_desc_1">用于对司机造成的人身伤害</p>
			          </div>
			         <div class="weui_media_hd" style="margin-right:.1em"  id="item-ifo">
			                 <input class="weui_input" type="text"    id="sjx"name="driver_insurance" style="font-size:12px;padding-left:4px;"
			                 {% if posted_data.driver_insurance %}value="{{posted_data.driver_insurance}}" {% else %}value="不投保" {% endif %} >
			                 <i class="fa fa-angle-down" id="ico" ></i>
			          </div>
		        </a>
		        <a href="javascript:void(0);" class="weui_media_box weui_media_appmsg" style ="padding:0px 15px;">
			          <div class="weui_media_bd">
			            <h4 class="weui_media_title weui_media_title_1"  style="font-size:14px;">乘客险</h4>
			            <p class="weui_media_desc weui_media_desc_1">车内本车乘客（非驾驶员）的人身伤亡费用</p>
			          </div>
			          <div class="weui_media_hd" style="margin-right:.1em"  id="item-ifo">
			                 <input class="weui_input" type="text"    id="ckx"  name="passenger_insurance" style="font-size:12px;padding-left:4px;"
			                 {% if posted_data.passenger_insurance %}value="{{posted_data.passenger_insurance}}" {% else %}value="不投保" {% endif %} >
			                 <i class="fa fa-angle-down" id="ico" ></i>
			          </div>
		        </a>
		        <a href="javascript:void(0);" class="weui_media_box weui_media_appmsg" style ="padding:0px 15px;">
			          <div class="weui_media_bd">
			            <h4 class="weui_media_title weui_media_title_1"  style="font-size:14px;">盗抢险</h4>
			            <p class="weui_media_desc weui_media_desc_1">用于赔付车辆被盗抢损失</p>
			          </div>
			         <div class="weui_media_hd" style="margin-right:.1em">
			                 <input class="weui_switch" type="checkbox"   id="dqx" name="theft_insurance"{% if posted_data.theft_insurance == 'on'  %} checked  {% endif %}>
			          </div>
		        </a>
		        <a href="javascript:void(0);" class="weui_media_box weui_media_appmsg" style ="padding:0px 15px;">
			          <div class="weui_media_bd">
			            <h4 class="weui_media_title weui_media_title_1"  style="font-size:14px;">不计免赔险</h4>
			            <p class="weui_media_desc weui_media_desc_1">事故发生时自己不再承担损失</p>
			          </div>
			         <div class="weui_media_hd" style="margin-right:.1em">
			                 <input class="weui_switch" type="checkbox"   {% if posted_data.iop_insurance == 'on'  %} checked  {% endif %} id="bjmpx" name="iop_insurance">
			          </div>
		        </a>
		        <a href="javascript:void(0);" class="weui_media_box weui_media_appmsg" style ="padding:0px 15px;">
			          <div class="weui_media_bd">
			            <h4 class="weui_media_title weui_media_title_1"  style="font-size:14px;">自燃损失险</h4>
			            <p class="weui_media_desc weui_media_desc_1">车辆的自身原因起火造成车辆本身的损失</p>
			          </div>
			         <div class="weui_media_hd" style="margin-right:.1em">
			                 <input class="weui_switch" type="checkbox"   id="zrssx" name="autoignition_insurance"{% if posted_data.autoignition_insurance == 'on'  %} checked  {% endif %}>
			          </div>
		        </a>
		       <a href="javascript:void(0);" class="weui_media_box weui_media_appmsg" style ="padding:0px 15px;">
			          <div class="weui_media_bd">
			            <h4 class="weui_media_title weui_media_title_1"  style="font-size:14px;">划痕险</h4>
			            <p class="weui_media_desc weui_media_desc_1">他人恶意行为造成的车辆车身人为划痕</p>
			          </div>
			          <div class="weui_media_hd" style="margin-right:.1em"  id="item-ifo">
			                <input class="weui_input" type="text"    id="hhx" name="scratch_insurance"  style="font-size:12px;padding-left:4px;"
			                {% if posted_data.scratch_insurance %}value="{{posted_data.scratch_insurance}}" {% else %}value="不投保" {% endif %} >
			                <i class="fa fa-angle-down" id="ico" ></i>
			          </div>
		        </a>
		        <a href="javascript:void(0);" class="weui_media_box weui_media_appmsg" style ="padding:0px 15px;">
			          <div class="weui_media_bd">
			            <h4 class="weui_media_title weui_media_title_1"  style="font-size:14px;">涉水险</h4>
			            <p class="weui_media_desc weui_media_desc_1">因水淹或涉水行驶造成发动机损坏的费用</p>
			          </div>
			         <div class="weui_media_hd" style="margin-right:.1em">
			                 <input class="weui_switch" type="checkbox"   id="shesx" name="wading_insurance"{% if posted_data.wading_insurance == 'on'  %} checked  {% endif %}>
			          </div>
		        </a>
		      </div>
		</div>
		
		<div class="weui_panel weui_panel_access">
		      <div class="weui_panel_hd"  style="background:#F3F3F3;text-align:left;">特别约定</div>
<!-- 		      <div class="weui_panel_bd"style="padding:15px">
			
			          <div class="weui_cell_bd weui_cell_primary " >
								<textarea class="weui_input" type="text"placeholder="没有特别约定可不填"  rows='10'   id="special_agreement" name="special_agreement" style="padding:0px;hight:26px"
								 {% if posted_data.special_agreement %}value="{{posted_data.special_agreement}}"{% else%}value='' {% endif %}/></textarea>
	                </div>
		      </div> -->
		      
		      <div class="weui-cells weui-cells_form"style="padding:15px">
			      <div class="weui-cell">
			        <div class="weui-cell__bd">
			          <textarea class="weui-textarea"placeholder="没有特别约定可不填"rows="3"id="special_agreement" name="special_agreement" style="padding:0px"
			          {% if posted_data.special_agreement %}value="{{posted_data.special_agreement}}"{% else%}value='' {% endif %}></textarea>
			        </div>
			      </div>
			    </div>
		</div>

		
		</div>
		<input type="button" name="previous" class="previous action-button" value="上一步" />
		<input type="button" name="next" class="next action-button" value="下一步" />
	</fieldset>
	<fieldset style="font-size:14px;">
	            <div class="weui_cell  wss_dashed_bottom" style="padding:10px 2px;" >
		            <div class="weui_cell_hd" style="width:40%;	text-align: left;">【交强险保险起期】</div>
		                <div class="weui_cell_bd weui_cell_primary " >
									  <input class="weui_input" data-descriptions="liability_expectStartTime1" data-required="true"   id="jiao_start_date" type="text" name="liability_expectStartTime" placeholder="请输入交强险起期时间" value="{{ posted_data.liability_expectStartTime}}"  style="height: 37px; width:95%;">
		                </div>
		        </div>
		        <div class="weui_cell  wss_dashed_bottom" style="padding:10px 2px;" >
		            <div class="weui_cell_hd" style="width:40%;	text-align: left;">【商业险保险起期】</div>
		                <div class="weui_cell_bd weui_cell_primary " >
									   <input class="weui_input"  data-descriptions="commercial_expectStartTime1"  data-required="true"  id="shang_start_date" type="text" name="commercial_expectStartTime" placeholder="请输入商业险起期时间" value="{{ posted_data.commercial_expectStartTime }}"  style="height: 37px; width:95%;">
		                </div>
		        </div>
		<input type="button" name="previous" class="previous action-button" value="上一步" />
		<input type="button" id="ok"name="ok" class="submit action-button" value="开始询价" />
		<!-- <input type="submit" name="submit" class="submit action-button" value="开始询价" /> -->
	</fieldset>

</form>
{% endblock %}
{% block script_block %}
<script src="/static/js/jquery-2.1.4.js" type="text/javascript"></script>
<script src="/static/js/fenbu/jquery.easing.min.js" type="text/javascript"></script>
<script src="/static/js/fenbu/zzsc.js" type="text/javascript"></script>
<script src="{% static 'js/jquery-mvalidate.js' %}"></script>
 <script src="{% static 'js/fastclick.js' %}"></script>
 <script>
  $(function() {
    FastClick.attach(document.body);
  });
/*   $(function() {
      $("#msform").mvalidate({
          type: 1,
          onKeyup: true,
          sendForm: true,
          firstInvalidFocus: false,
          valid: function(event, options) {
              //点击提交按钮时,表单通过验证触发函数
              $("#wss_jdcbx_form").submit();
              event.preventDefault();
          },
          descriptions: {
        	  driving_license_up: {
                  required: '请选择行驶证正页图片'
                },
          	  driving_license_down: {
                  required: '请选择行驶证附页图片'
                },
                applicant_company_name: {
                   required: '请选择单位名称'
                 },
                
          }
      });
  }); */
 </script>
 <script src="{% static 'js/jquery-weui.js' %}"></script>
  <script src="{% static 'js/city-picker.js' %}"></script>
  <script src="{% static 'js/swiper.js' %}"></script>
    <script type="text/javascript">
{#行驶证证正面照#}
$(function () {
// 允许上传的图片类型
var allowTypes = ['image/jpg', 'image/jpeg', 'image/png', 'image/gif'];
// 1024KB，也就是 1MB
var maxSize = 3072 * 3072;
// 图片最大宽度
var maxWidth = 400;
// 最大上传图片数量
var maxCount = 1;
$('.driving_license').on('change', function (event) {
var files = event.target.files;

// 如果没有选中文件，直接返回
if (files.length === 0) {
return;
}

for (var i = 0, len = files.length; i < len; i++) {
var file = files[i];
var reader = new FileReader();
// 如果类型不在允许的类型范围内
if (allowTypes.indexOf(file.type) === -1) {
$.weui.alert({text: '该类型不允许上传'});
continue;
}

if (file.size > maxSize) {
$.weui.alert({text: '图片太大，不允许上传'});
continue;
}

if ($('.li_driving_license').length >= maxCount) {
$.weui.alert({text: '最多只能上传' + maxCount + '张图片'});
return;
}
reader.onload = function (e) {

var img = new Image();
img.onload = function () {
// 不要超出最大宽度
var w = Math.min(maxWidth, img.width);
// 高度按比例计算
var h = img.height * (w / img.width);
var canvas = document.createElement('canvas');
var ctx = canvas.getContext('2d');
// 设置 canvas 的宽度和高度
canvas.width = w;
canvas.height = h;
ctx.drawImage(img, 0, 0, w, h);
var base64 = canvas.toDataURL('image/png');
console.log(base64);
// 插入到预览区
var $preview = $('<li class="weui_uploader_file weui_uploader_status li_driving_license" style="background-image:url(' + base64 + ')" onclick="deletePic(this);"></li>');
$('.ul_driving_license').append($preview);
$('.driving_license').parent('.weui_uploader_input_wrp').hide();
{#var num = $('.weui_uploader_file').length;#}
{#$('.js_counter').text(num + '/' + maxCount);#}
    
{#setTimeout(uploading('.uploader_national_image'), 30);#}
};
img.src = e.target.result;
    $('#id_national_image_hidden').val(img.src);
};
reader.readAsDataURL(file);
}
});

});
{#行驶证证背面照#}
$(function () {
// 允许上传的图片类型
var allowTypes = ['image/jpg', 'image/jpeg', 'image/png', 'image/gif'];
// 1024KB，也就是 1MB
var maxSize = 3072 * 3072;
// 图片最大宽度
var maxWidth = 400;
// 最大上传图片数量
var maxCount = 1;

$('.driving_license_down').on('change', function (event) {
var files = event.target.files;

// 如果没有选中文件，直接返回
if (files.length === 0) {
return;
}

for (var i = 0, len = files.length; i < len; i++) {
var file = files[i];
var reader = new FileReader();
// 如果类型不在允许的类型范围内
if (allowTypes.indexOf(file.type) === -1) {
$.weui.alert({text: '该类型不允许上传'});
continue;
}

if (file.size > maxSize) {
$.weui.alert({text: '图片太大，不允许上传'});
continue;
}

if ($('.li_driving_license_down').length >= maxCount) {
$.weui.alert({text: '最多只能上传' + maxCount + '张图片'});
return;
}
reader.onload = function (e) {
var img = new Image();
img.onload = function () {
// 不要超出最大宽度
var w = Math.min(maxWidth, img.width);
// 高度按比例计算
var h = img.height * (w / img.width);
var canvas = document.createElement('canvas');
var ctx = canvas.getContext('2d');
// 设置 canvas 的宽度和高度
canvas.width = w;
canvas.height = h;
ctx.drawImage(img, 0, 0, w, h);
var base64 = canvas.toDataURL('image/png');
console.log(base64);
// 插入到预览区
var $preview = $('<li class="weui_uploader_file weui_uploader_status li_driving_license_down" style="background-image:url(' + base64 + ')" onclick="deletePic(this);"></li>');
$('.ul_driving_license_down').append($preview);
$('.driving_license_down').parent('.weui_uploader_input_wrp').hide();
{#var num = $('.weui_uploader_file').length;#}
{#$('.js_counter').text(num + '/' + maxCount);#}
};
img.src = e.target.result;
    $('#id_national_image_down_hidden').val(img.src);
};
reader.readAsDataURL(file);
}
});
});
{#营业执照照片#}
$(function () {
// 允许上传的图片类型
var allowTypes = ['image/jpg', 'image/jpeg', 'image/png', 'image/gif'];
// 1024KB，也就是 1MB
var maxSize = 3072 * 3072;
// 图片最大宽度
var maxWidth = 400;
// 最大上传图片数量
var maxCount = 1;

$('.national_image_yingye').on('change', function (event) {
var files = event.target.files;

// 如果没有选中文件，直接返回
if (files.length === 0) {
return;
}

for (var i = 0, len = files.length; i < len; i++) {
var file = files[i];
var reader = new FileReader();
// 如果类型不在允许的类型范围内
if (allowTypes.indexOf(file.type) === -1) {
$.weui.alert({text: '该类型不允许上传'});
continue;
}

if (file.size > maxSize) {
$.weui.alert({text: '图片太大，不允许上传'});
continue;
}

if ($('.li_national_image_down').length >= maxCount) {
$.weui.alert({text: '最多只能上传' + maxCount + '张图片'});
return;
}
reader.onload = function (e) {
var img = new Image();
img.onload = function () {
// 不要超出最大宽度
var w = Math.min(maxWidth, img.width);
// 高度按比例计算
var h = img.height * (w / img.width);
var canvas = document.createElement('canvas');
var ctx = canvas.getContext('2d');
// 设置 canvas 的宽度和高度
canvas.width = w;
canvas.height = h;
ctx.drawImage(img, 0, 0, w, h);
var base64 = canvas.toDataURL('image/png');
console.log(base64);
// 插入到预览区
var $preview = $('<li class="weui_uploader_file weui_uploader_status li_national_image_yingye" style="background-image:url(' + base64 + ')" onclick="deletePic(this);"></li>');
$('.ul_national_image_yingye').append($preview);
$('.national_image_yingye').parent('.weui_uploader_input_wrp').hide();
{#var num = $('.weui_uploader_file').length;#}
{#$('.js_counter').text(num + '/' + maxCount);#}
};
img.src = e.target.result;
    $('#id_national_image_yingye_hidden').val(img.src);
};
reader.readAsDataURL(file);
}
});
});
{#被保人单位营业执照照片#}
$(function () {
// 允许上传的图片类型
var allowTypes = ['image/jpg', 'image/jpeg', 'image/png', 'image/gif'];
// 1024KB，也就是 1MB
var maxSize = 3072 * 3072;
// 图片最大宽度
var maxWidth = 400;
// 最大上传图片数量
var maxCount = 1;

$('.bbx_national_image_yingye').on('change', function (event) {
var files = event.target.files;

// 如果没有选中文件，直接返回
if (files.length === 0) {
return;
}

for (var i = 0, len = files.length; i < len; i++) {
var file = files[i];
var reader = new FileReader();
// 如果类型不在允许的类型范围内
if (allowTypes.indexOf(file.type) === -1) {
$.weui.alert({text: '该类型不允许上传'});
continue;
}

if (file.size > maxSize) {
$.weui.alert({text: '图片太大，不允许上传'});
continue;
}

if ($('.li_bbx_national_image_down').length >= maxCount) {
$.weui.alert({text: '最多只能上传' + maxCount + '张图片'});
return;
}
reader.onload = function (e) {
var img = new Image();
img.onload = function () {
// 不要超出最大宽度
var w = Math.min(maxWidth, img.width);
// 高度按比例计算
var h = img.height * (w / img.width);
var canvas = document.createElement('canvas');
var ctx = canvas.getContext('2d');
// 设置 canvas 的宽度和高度
canvas.width = w;
canvas.height = h;
ctx.drawImage(img, 0, 0, w, h);
var base64 = canvas.toDataURL('image/png');
console.log(base64);
// 插入到预览区
var $preview = $('<li class="weui_uploader_file weui_uploader_status li_bbx_national_image_down" style="background-image:url(' + base64 + ')" onclick="deletePic(this);"></li>');
$('.ul_bbx_national_image_yingye').append($preview);
$('.bbx_national_image_yingye').parent('.weui_uploader_input_wrp').hide();
{#var num = $('.weui_uploader_file').length;#}
{#$('.js_counter').text(num + '/' + maxCount);#}
};
img.src = e.target.result;
    $('#id_national_image_yingye_hidden').val(img.src);
};
reader.readAsDataURL(file);
}
});
});
function deletePic(obj){
	if (confirm("确认删除该上传图片吗?")){
		$(obj).parent('.weui_uploader_files').siblings(".weui_uploader_input_wrp").show();
		$(obj).remove();
	}
}

$("#user_classify").select({
  title: "选择用户类型",
  items: ["单位", "个人"],
  onChange: function(d) {
    console.log(this, d);
  },
  onClose: function() {
    console.log("close");
  },
  onOpen: function() {
    console.log("open");
  },
});
$("#bbx_user_classify").select({
	  title: "选择用户类型",
	  items: ["单位", "个人"],
	  onChange: function(d) {
	    console.log(this, d);
	  },
	  onClose: function() {
	    console.log("close");
	  },
	  onOpen: function() {
	    console.log("open");
	  },
	});

$("#ismatchxsz").change(function(){
	  if ( $("#ismatchxsz").is(':checked')){
  	  $("#noMatchT").css("display","none");
  	  $("#company").css("display","none");
  	  $("#person").css("display","none");
  	  $("#ismatchxsz").css("value","1");
  	  return ;
	  }
	  $("#noMatchT").css("display","block");
	  $("#ismatchxsz").css("value","0");
	  var user_classify = $("#user_classify").val();
	  if (user_classify == '个人'){
		  $("#person").css("display","block");
		  $("#person1").css("display","block");
		  $("#company").css("display","none");
		  $("#company1").css("display","none");
	  }else{
		  $("#company").css("display","block");
		  $("#company1").css("display","block");
		  $("#person").css("display","none");
		  $("#person1").css("display","none");
	  }

	});

$("#ismatchtbr").change(function(){
	  if ( $("#ismatchtbr").is(':checked')){
  	  $("#notmatchtbr").css("display","none");
  	  return ;
	  }
	  $("#notmatchtbr").css("display","block");
	});
$("#ssq").cityPicker({
    title: "选择省市区",
    onChange: function (picker, values, displayValues) {
      console.log(values, displayValues);
    }
  });

$("#user_classify").change(function(){
/*  	  if ( $("#ismatchxsz").is(':checked')){
  	  return ;
	  } */
	  //$("#noMatchT").css("display","block");
	  if ($("#user_classify").val() == '个人'){
		  if ( $("#ismatchxsz").is(':checked')){
			  $("#person").css("display","none");
  		  $("#company").css("display","none");
  		  $("#person1").css("display","block");
  		  $("#company1").css("display","none");
		  }
		  else{
			  $("#person").css("display","block");
  		  $("#company").css("display","none");
  		  $("#person1").css("display","block");
  		  $("#company1").css("display","none");
		  }
	  }else{
		  if ( $("#ismatchxsz").is(':checked')){
			  $("#person").css("display","none");
  		  $("#company").css("display","none");
  		  $("#person1").css("display","none");
  		  $("#company1").css("display","block");
		  }
		  else{
			  $("#person").css("display","none");
  		  $("#company").css("display","block");
  		  $("#person1").css("display","none");
  		  $("#company1").css("display","block");
		  }
	  }
	});
$("#bbx_user_classify").change(function(){
		  if ($("#bbx_user_classify").val() == '个人'){
			  $("#bbx_company").css("display","none");
	  		  $("#bbx_person").css("display","block");
		  }else{
			  $("#bbx_company").css("display","block");
	  		  $("#bbx_person").css("display","none");
		  }
		});
{#身份证正面照#}
$(function () {
// 允许上传的图片类型
var allowTypes = ['image/jpg', 'image/jpeg', 'image/png', 'image/gif'];
// 1024KB，也就是 1MB
var maxSize = 3072 * 3072;
// 图片最大宽度
var maxWidth = 400;
// 最大上传图片数量
var maxCount = 1;
$('.national_image').on('change', function (event) {
var files = event.target.files;

// 如果没有选中文件，直接返回
if (files.length === 0) {
return;
}

for (var i = 0, len = files.length; i < len; i++) {
var file = files[i];
var reader = new FileReader();
// 如果类型不在允许的类型范围内
if (allowTypes.indexOf(file.type) === -1) {
$.weui.alert({text: '该类型不允许上传'});
continue;
}

if (file.size > maxSize) {
$.weui.alert({text: '图片太大，不允许上传'});
continue;
}

if ($('.li_national_image').length >= maxCount) {
$.weui.alert({text: '最多只能上传' + maxCount + '张图片'});
return;
}
reader.onload = function (e) {

var img = new Image();
img.onload = function () {
// 不要超出最大宽度
var w = Math.min(maxWidth, img.width);
// 高度按比例计算
var h = img.height * (w / img.width);
var canvas = document.createElement('canvas');
var ctx = canvas.getContext('2d');
// 设置 canvas 的宽度和高度
canvas.width = w;
canvas.height = h;
ctx.drawImage(img, 0, 0, w, h);
var base64 = canvas.toDataURL('image/png');
console.log(base64);
// 插入到预览区
var $preview = $('<li class="weui_uploader_file weui_uploader_status li_national_image" style="background-image:url(' + base64 + ')" onclick="deletePic(this);"></li>');
$('.ul_national_image').append($preview);
$('.national_image').parent('.weui_uploader_input_wrp').hide();
{#var num = $('.weui_uploader_file').length;#}
{#$('.js_counter').text(num + '/' + maxCount);#}
    
{#setTimeout(uploading('.uploader_national_image'), 30);#}
};
img.src = e.target.result;
    $('#id_national_image_hidden').val(img.src);
};
reader.readAsDataURL(file);
}
});

});
{#身份证背面照#}
$(function () {
// 允许上传的图片类型
var allowTypes = ['image/jpg', 'image/jpeg', 'image/png', 'image/gif'];
// 1024KB，也就是 1MB
var maxSize = 3072 * 3072;
// 图片最大宽度
var maxWidth = 400;
// 最大上传图片数量
var maxCount = 1;

$('.national_image_down').on('change', function (event) {
var files = event.target.files;

// 如果没有选中文件，直接返回
if (files.length === 0) {
return;
}

for (var i = 0, len = files.length; i < len; i++) {
var file = files[i];
var reader = new FileReader();
// 如果类型不在允许的类型范围内
if (allowTypes.indexOf(file.type) === -1) {
$.weui.alert({text: '该类型不允许上传'});
continue;
}

if (file.size > maxSize) {
$.weui.alert({text: '图片太大，不允许上传'});
continue;
}

if ($('.li_national_image_down').length >= maxCount) {
$.weui.alert({text: '最多只能上传' + maxCount + '张图片'});
return;
}
reader.onload = function (e) {
var img = new Image();
img.onload = function () {
// 不要超出最大宽度
var w = Math.min(maxWidth, img.width);
// 高度按比例计算
var h = img.height * (w / img.width);
var canvas = document.createElement('canvas');
var ctx = canvas.getContext('2d');
// 设置 canvas 的宽度和高度
canvas.width = w;
canvas.height = h;
ctx.drawImage(img, 0, 0, w, h);
var base64 = canvas.toDataURL('image/png');
console.log(base64);
// 插入到预览区
var $preview = $('<li class="weui_uploader_file weui_uploader_status li_national_image_down" style="background-image:url(' + base64 + ')" onclick="deletePic(this);"></li>');
$('.ul_national_image_down').append($preview);
$('.national_image_down').parent('.weui_uploader_input_wrp').hide();
{#var num = $('.weui_uploader_file').length;#}
{#$('.js_counter').text(num + '/' + maxCount);#}
};
img.src = e.target.result;
    $('#id_national_image_down_hidden').val(img.src);
};
reader.readAsDataURL(file);
}
});
});
{#被投保人身份证正面照#}
$(function () {
// 允许上传的图片类型
var allowTypes = ['image/jpg', 'image/jpeg', 'image/png', 'image/gif'];
// 1024KB，也就是 1MB
var maxSize = 3072 * 3072;
// 图片最大宽度
var maxWidth = 400;
// 最大上传图片数量
var maxCount = 1;
$('.bbx_carded_image').on('change', function (event) {
var files = event.target.files;

// 如果没有选中文件，直接返回
if (files.length === 0) {
return;
}

for (var i = 0, len = files.length; i < len; i++) {
var file = files[i];
var reader = new FileReader();
// 如果类型不在允许的类型范围内
if (allowTypes.indexOf(file.type) === -1) {
$.weui.alert({text: '该类型不允许上传'});
continue;
}

if (file.size > maxSize) {
$.weui.alert({text: '图片太大，不允许上传'});
continue;
}

if ($('.li_bbx_carded_image').length >= maxCount) {
$.weui.alert({text: '最多只能上传' + maxCount + '张图片'});
return;
}
reader.onload = function (e) {

var img = new Image();
img.onload = function () {
// 不要超出最大宽度
var w = Math.min(maxWidth, img.width);
// 高度按比例计算
var h = img.height * (w / img.width);
var canvas = document.createElement('canvas');
var ctx = canvas.getContext('2d');
// 设置 canvas 的宽度和高度
canvas.width = w;
canvas.height = h;
ctx.drawImage(img, 0, 0, w, h);
var base64 = canvas.toDataURL('image/png');
console.log(base64);
// 插入到预览区
var $preview = $('<li class="weui_uploader_file weui_uploader_status li_bbx_carded_image" style="background-image:url(' + base64 + ')" onclick="deletePic(this);"></li>');
$('.ul_bbx_carded_image').append($preview);
$('.bbx_carded_image').parent('.weui_uploader_input_wrp').hide();
{#var num = $('.weui_uploader_file').length;#}
{#$('.js_counter').text(num + '/' + maxCount);#}
    
{#setTimeout(uploading('.uploader_national_image'), 30);#}
};
img.src = e.target.result;
    $('#id_national_image_hidden').val(img.src);
};
reader.readAsDataURL(file);
}
});

});
{#被投保人身份证背面照#}
$(function () {
// 允许上传的图片类型
var allowTypes = ['image/jpg', 'image/jpeg', 'image/png', 'image/gif'];
// 1024KB，也就是 1MB
var maxSize = 3072 * 3072;
// 图片最大宽度
var maxWidth = 400;
// 最大上传图片数量
var maxCount = 1;

$('.bbx_carded_image_down').on('change', function (event) {
var files = event.target.files;

// 如果没有选中文件，直接返回
if (files.length === 0) {
return;
}

for (var i = 0, len = files.length; i < len; i++) {
var file = files[i];
var reader = new FileReader();
// 如果类型不在允许的类型范围内
if (allowTypes.indexOf(file.type) === -1) {
$.weui.alert({text: '该类型不允许上传'});
continue;
}

if (file.size > maxSize) {
$.weui.alert({text: '图片太大，不允许上传'});
continue;
}

if ($('.li_bbx_carded_image_down').length >= maxCount) {
$.weui.alert({text: '最多只能上传' + maxCount + '张图片'});
return;
}
reader.onload = function (e) {
var img = new Image();
img.onload = function () {
// 不要超出最大宽度
var w = Math.min(maxWidth, img.width);
// 高度按比例计算
var h = img.height * (w / img.width);
var canvas = document.createElement('canvas');
var ctx = canvas.getContext('2d');
// 设置 canvas 的宽度和高度
canvas.width = w;
canvas.height = h;
ctx.drawImage(img, 0, 0, w, h);
var base64 = canvas.toDataURL('image/png');
console.log(base64);
// 插入到预览区
var $preview = $('<li class="weui_uploader_file weui_uploader_status li_bbx_carded_image_down" style="background-image:url(' + base64 + ')" onclick="deletePic(this);"></li>');
$('.ul_bbx_carded_image_down').append($preview);
$('.bbx_carded_image_down').parent('.weui_uploader_input_wrp').hide();
{#var num = $('.weui_uploader_file').length;#}
{#$('.js_counter').text(num + '/' + maxCount);#}
};
img.src = e.target.result;
    $('#id_national_image_down_hidden').val(img.src);
};
reader.readAsDataURL(file);
}
});
});
$("#szx").select({
    title: "选择",
    items: ["不投保","10万", "20万","30万", "50万","100万", "150万","200万", "250万", "300万"],
    onChange: function(d) {
      console.log(this, d);
    },
    onClose: function() {
      console.log("close");
    },
    onOpen: function() {
      console.log("open");
    },
  });
  $("#blx").select({
      title: "选择",
      items: ["不投保","国产", "进口"],
      onChange: function(d) {
        console.log(this, d);
      },
      onClose: function() {
        console.log("close");
      },
      onOpen: function() {
        console.log("open");
      },
    });
  $("#sjx").select({
      title: "选择",
      items: ["不投保","1万", "2万","5万", "10万","20万"],
      onChange: function(d) {
        console.log(this, d);
      },
      onClose: function() {
        console.log("close");
      },
      onOpen: function() {
        console.log("open");
      },
    });
  $("#ckx").select({
      title: "选择",
      items: ["不投保","1万", "2万","5万", "10万","20万"],
      onChange: function(d) {
        console.log(this, d);
      },
      onClose: function() {
        console.log("close");
      },
      onOpen: function() {
        console.log("open");
      },
    });
  $("#hhx").select({
      title: "选择",
      items: ["不投保","2千", "5千","1万", "2万"],
      onChange: function(d) {
        console.log(this, d);
      },
      onClose: function() {
        console.log("close");
      },
      onOpen: function() {
        console.log("open");
      },
    });
  $("#jiao_start_date").calendar({
		onChange: function (p, values, displayValues) {
	      console.log(values, displayValues);
	    }
	  });
	$("#shang_start_date").calendar({
		onChange: function (p, values, displayValues) {
	      console.log(values, displayValues);
	    }
	  });
    var pb2 = $.photoBrowser({
        items: [
          {
            image: "/static/pic/default/example5.png",
            caption: "行驶证正面样例图片。点击图片将退出样例图片预览模式！"
          },
          {
            image: "/static/pic/default/example4.png",
            caption: "行驶证反面样例图片。点击图片将退出样例图片预览模式！"
          }
        ],
        initIndex: 0
      });
      $("#pb2").click(function() {
        pb2.open();
      });
</script>
<script src="{% static 'js/jquery.form.js' %}"></script>
<script type="text/javascript">
$("#ok").click(function() {  
	//action="/wss/insure/jdclbx_order_create_new/"
    $("#msform").ajaxSubmit({  
        url : "/wss/insure/jdclbx_order_create_new/",  
        type : "post",  
        dataType : 'json',  
        success : function(data) {  
            var code = data['code'];
	          if (code=='1'){
	        	  var message = data['message'];
	        	 // alert(message);
	        	  document.getElementById('id_message_id').innerText=message;
		          	$('#detail_model').removeClass('control-show');
	          }
	          else if  (code=='0'){
	        	  var jdclbx_id = data['data']['jdclbx_id'];
	        	  window.location.href= "/wss/insure/jdclbx_detail/"+jdclbx_id;
	          }
	          else{
	        	  alert('网络延迟，请稍后再试');
		          }
        },  
        error : function(data) {  
            alert("error:" + data.responseText);  
        }  
    });  
});  
</script>
{% endblock %}